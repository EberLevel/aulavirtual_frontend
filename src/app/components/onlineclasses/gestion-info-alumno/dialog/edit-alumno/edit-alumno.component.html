<p-panel>
    <ng-template pTemplate="header">
        <span class="text-primary font-semibold text-xl"
            >Actualizar Alumno</span
        >
    </ng-template>
    <ng-template pTemplate="content">
        <form [formGroup]="alumnoForm">
            <div class="row mb-4">
                <div class="grid p-fluid">
                    <div class="field md:col-6">
                        <span class="p-float-label p-input-icon-left">
                            <i class="pi pi-user-edit"></i>
                            <input
                                type="text"
                                id="codigo"
                                pInputText
                                formControlName="codigo"
                            />
                            <label for="codigo">Código de Estudiante</label>
                        </span>
                        <small
                            style="color: brown"
                            *ngIf="
                                alumnoForm.get('codigo')?.invalid &&
                                alumnoForm.get('codigo')?.touched
                            "
                            >Campo obligatorio *</small
                        >
                    </div>
                    <div class="field md:col-6">
                        <span class="p-float-label">
                            <p-dropdown
                                inputId="tipoDocumento"
                                [autoDisplayFirst]="false"
                                [options]="tipodocu"
                                formControlName="tipoDocumento"
                                optionLabel="name"
                                optionValue="value"
                            ></p-dropdown>
                            <label for="tipoDocumento"
                                >Tipo de documento de identidad</label
                            >
                            <small
                                style="color: brown"
                                *ngIf="
                                    alumnoForm.get('tipoDocumento')?.invalid &&
                                    alumnoForm.get('tipoDocumento')?.touched
                                "
                                >Campo obligatorio *</small
                            >
                        </span>
                    </div>
                </div>
            </div>
            <div class="row mb-4">
                <div class="grid p-fluid">
                    <div class="field md:col-6">
                        <span class="p-float-label p-input-icon-left">
                            <i class="pi pi-user-edit"></i>
                            <input
                                type="text"
                                id="numeroDocumento"
                                pInputText
                                formControlName="numeroDocumento"
                            />
                            <label for="numeroDocumento"
                                >Numero de Documento</label
                            >
                        </span>
                        <small
                            style="color: brown"
                            *ngIf="
                                alumnoForm.get('numeroDocumento')?.invalid &&
                                alumnoForm.get('numeroDocumento')?.touched
                            "
                            >Campo obligatorio *</small
                        >
                    </div>
                    <div class="field md:col-6">
                        <span class="p-float-label p-input-icon-left">
                            <i class="pi pi-user-edit"></i>
                            <input
                                type="text"
                                id="nombres"
                                pInputText
                                formControlName="nombres"
                            />
                            <label for="nombres">Nombres</label>
                        </span>
                        <small
                            style="color: brown"
                            *ngIf="
                                alumnoForm.get('nombres')?.invalid &&
                                alumnoForm.get('nombres')?.touched
                            "
                            >Campo obligatorio *</small
                        >
                    </div>
                    <div class="field md:col-6">
                        <span class="p-float-label p-input-icon-left">
                            <i class="pi pi-user-edit"></i>
                            <input
                                type="text"
                                id="apellidos"
                                pInputText
                                formControlName="apellidos"
                            />
                            <label for="apellidos">Apellidos</label>
                        </span>
                        <small
                            style="color: brown"
                            *ngIf="
                                alumnoForm.get('apellidos')?.invalid &&
                                alumnoForm.get('apellidos')?.touched
                            "
                            >Campo obligatorio *</small
                        >
                    </div>
                    <div class="field md:col-6">
                        <span class="p-float-label p-input-icon-left">
                            <i class="pi pi-user-edit"></i>
                            <input
                                type="text"
                                id="email"
                                pInputText
                                formControlName="email"
                            />
                            <label for="email">Correo</label>
                        </span>
                        <small
                            style="color: brown"
                            *ngIf="
                                alumnoForm.get('email')?.invalid &&
                                alumnoForm.get('email')?.touched
                            "
                            >Campo obligatorio *</small
                        >
                    </div>
                    <div class="field md:col-6">
                        <span class="p-float-label p-input-icon-left">
                            <i class="pi pi-user-edit"></i>
                            <input
                                type="password"
                                id="contraseña"
                                pInputText
                                formControlName="contraseña"
                            />
                            <label for="contraseña">Clave</label>
                        </span>
                        <small
                            style="color: brown"
                            *ngIf="
                                alumnoForm.get('contraseña')?.invalid &&
                                alumnoForm.get('contraseña')?.touched
                            "
                            >Campo obligatorio *</small
                        >
                    </div>
                    <div class="field md:col-6">
                        <span class="p-float-label">
                            <p-dropdown
                                inputId="estadoId"
                                [options]="estadosList"
                                formControlName="estadoId"
                                optionLabel="name"
                                optionValue="value"
                                placeholder="Selecciona un estado"
                            ></p-dropdown>

                            <label for="estadoId">Estado de la Unidad Didactica</label>
                            <small
                                style="color: brown"
                                *ngIf="
                                    alumnoForm.get('estadoId')?.invalid &&
                                    alumnoForm.get('estadoId')?.touched
                                "
                            >
                                Campo obligatorio *
                            </small>
                        </span>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="grid p-fluid">
                    <div class="field md:col-6">
                        <span class="p-float-label p-input-icon-left">
                            <i class="pi pi-user-edit"></i>
                            <input
                                type="text"
                                id="direccion"
                                pInputText
                                formControlName="direccion"
                            />
                            <label for="direccion">Direccion</label>
                        </span>
                        <small
                            style="color: brown"
                            *ngIf="
                                alumnoForm.get('direccion')?.invalid &&
                                alumnoForm.get('direccion')?.touched
                            "
                            >Campo obligatorio *</small
                        >
                    </div>
                    <div class="field md:col-6">
                        <span class="p-float-label p-input-icon-left">
                            <i class="pi pi-user-edit"></i>
                            <input
                                type="text"
                                id="nroCelular"
                                pInputText
                                formControlName="nroCelular"
                            />
                            <label for="nroCelular">Nro de Celular</label>
                        </span>
                        <small
                            style="color: brown"
                            *ngIf="
                                alumnoForm.get('nroCelular')?.invalid &&
                                alumnoForm.get('nroCelular')?.touched
                            "
                            >Campo obligatorio *</small
                        >
                        <small
                            style="color: brown"
                            *ngIf="
                                alumnoForm
                                    .get('nroCelular')
                                    ?.hasError('pattern') &&
                                alumnoForm.get('nroCelular')?.touched
                            "
                            >Formato inválido *</small
                        >
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="grid p-fluid">
                    <div class="field md:col-6">
                        <span class="p-float-label">
                            <p-dropdown
                                inputId="carreraId"
                                [options]="carrerasList"
                                formControlName="carreraId"
                                optionLabel="name"
                                optionValue="value"
                                placeholder="Selecciona una carrera"
                            ></p-dropdown>
                            <label for="carreraId">Carrera Profesional</label>
                            <small style="color: brown;" *ngIf="alumnoForm.get('carreraId')?.invalid && alumnoForm.get('carreraId')?.touched">
                                Debes seleccionar una carrera
                            </small>
                        </span>
                        
                    </div>
                    <div class="field md:col-6">
                        <span class="p-float-label">
                            <p-dropdown
                                inputId="cicloId"
                                [options]="ciclosList"
                                formControlName="cicloId"
                                optionLabel="name"
                                optionValue="value"
                                placeholder="Selecciona un ciclo"
                            ></p-dropdown>
                            <label for="cicloId">Ciclos académicos</label>
                        </span>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="grid p-fluid">
                    <div class="field md:col-6">
                        <span class="p-float-label">
                            <p-calendar
                                inputId="fechaNacimiento"
                                formControlName="fechaNacimiento"
                                [showTime]="false"
                                [showSeconds]="false"
                                (onSelect)="capturarFecha($event)"
                                dateFormat="dd-mm-yy"
                            >
                            </p-calendar>
                            <label for="fechaNacimiento"
                                >Fecha de nacimiento</label
                            >
                        </span>
                        <small
                            style="color: brown"
                            *ngIf="
                                alumnoForm.get('fechaNacimiento')?.invalid &&
                                alumnoForm.get('fechaNacimiento')?.touched
                            "
                            >Campo obligatorio *</small
                        >
                    </div>
                    <div class="field md:col-6">
                        <span class="p-float-label">
                            <p-dropdown
                                inputId="promocionId"
                                [options]="promocionesList"
                                formControlName="promocionId"
                                optionLabel="name"
                                optionValue="value"
                                placeholder="Selecciona una promoción"
                            ></p-dropdown>
                            <label for="promocionId">Promociones</label>
                            <small
                                style="color: brown"
                                *ngIf="
                                    alumnoForm.get('promocionId')?.invalid &&
                                    alumnoForm.get('promocionId')?.touched
                                "
                            >
                                Campo obligatorio *
                            </small>
                        </span>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="grid p-fluid">
                    <div class="field md:col-6">
                        <span class="p-float-label">
                            <p-dropdown
                                inputId="estadoAlumno"
                                [options]="estadoAlumnoOptions"
                                formControlName="estadoAlumno"
                                optionLabel="label"
                                optionValue="value"
                                placeholder="Selecciona estado"
                            ></p-dropdown>
                            <label for="estadoAlumno">Estado del alumno</label>
                            <small style="color: brown;" *ngIf="alumnoForm.get('estadoAlumno')?.invalid && alumnoForm.get('estadoAlumno')?.touched">
                                Campo obligatorio *
                            </small>
                        </span>
                    </div>
                </div>
            </div>
            <div class="row mb-4">
                <div class="grid p-fluid">
                    <div class="field md:col-6">
                        <p-toast></p-toast>
                        <p-fileUpload
                            mode="basic"
                            chooseLabel="Adjunte foto de Perfil"
                            chooseIcon="pi pi-upload"
                            name="demo[]"
                            url="https://www.primefaces.org/cdn/api/upload.php"
                            accept="image/*"
                            (onUpload)="onUpload($event)"
                            (onSelect)="onPerfilSelect($event)"
                        ></p-fileUpload>
                    </div>
                    <div class="field md:col-6">
                        <p-toast></p-toast>
                        <p-fileUpload
                            mode="basic"
                            chooseLabel="Adjunte foto tamaño carnet"
                            chooseIcon="pi pi-upload"
                            name="demo[]"
                            url="https://www.primefaces.org/cdn/api/upload.php"
                            accept="image/*"
                            (onUpload)="onUpload($event)"
                            (onSelect)="onCarnetSelect($event)"
                        ></p-fileUpload>
                    </div>
                </div>
            </div>
            <div class="row mb-5 text-right">
                <button
                *ngIf="role_id === 12"
                pButton
                label="Ver pagos"
                icon="pi pi-shopping-cart"
                id="btnnavigateToAvanceCurricular"
                class="p-button-warning mr-2"
                (click)="openModalPagos()"
                style="display: none;"
                type="button"
            ></button>            
                <button
                pButton
                label="Avance Curricular"
                icon="pi pi-refresh"
                id="btnnavigateToAvanceCurricular"
                class="p-button-alert mr-2"
                (click)="navigateToAvanceCurricular(alumno)"
                type="button"
            ></button>            
                <button
                    pButton
                    label="Actualizar"
                    icon="pi pi-refresh"
                    id="btnActualizar"
                    class="p-button-info mr-2"
                    (click)="actualizarAlumno()"
                    [disabled]="alumnoForm.invalid || !alumnoForm.get('carreraId')?.value"
                    type="button"
                ></button>
                <button
                    pButton
                    label="Cancelar"
                    (click)="closeModal()"
                    icon="pi pi-times"
                    id="btnCancelar"
                    class="p-button-danger"
                ></button>
            </div>
        </form>
        <ngx-spinner
            *ngIf="loading"
            bdColor="rgba(0,0,0,0.5)"
            size="large"
            color="#fff"
            type="ball-spin"
        ></ngx-spinner>
    </ng-template>

<p-dialog 
    [(visible)]="showModalPagos" 
    header="Subir Comprobante de Pago" 
    [style]="{ width: '600px' }" 
    [modal]="true" 
    [closable]="true"
    class="custom-dialog"
    >

    <p-table 
        [value]="pagoAlumnosList"
        [paginator]="true" 
        [rows]="5" 
        responsiveLayout="scroll" 
        [selectionMode]="'single'"
        
        class="custom-table"
    >
        <ng-template pTemplate="header">
            <tr>
                <th>Pago</th>
                <th>Monto</th>
                <th>Estado</th>
                <th>Fecha Vencimiento</th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-rowData>
            <tr>
                <td>{{ rowData.nombre }}</td>
                <td>{{ rowData.monto }}</td>
                <td>{{ rowData.estado }}</td>
                <td>{{ rowData.fecha_vencimiento }}</td>
            </tr>
        </ng-template>
    </p-table>

    <form [formGroup]="uploadForm" (ngSubmit)="onSubmit()">
        <div class="form-group mt-3">
        <label for="pago" class="custom-label">Seleccionar Pago</label>
        <select formControlName="pago_id" class="form-control custom-select">
            <option *ngFor="let pago of pagosPendientes" [value]="pago.pago_alumno_id">
                {{ pago.nombre }} - {{ pago.monto }}
              </option>
        </select>
        </div>

    <div class="form-group mt-3">
      <label for="voucher" class="custom-label">Subir Comprobante</label>
      <div class="custom-file-upload">
        <input
          type="file"
          id="voucher"
          class="form-control-file"
          (change)="onFileSelect($event)"
        />
      </div>
    </div>

    <p-footer class="modal-footer mt-4">
      <button
        type="submit"
        pButton
        label="Subir"
        icon="pi pi-upload"
        class="p-button-success custom-button"
        [disabled]="!uploadForm.valid || !voucherBase64"
      ></button>
      <button
        type="button"
        pButton
        label="Cancelar"
        icon="pi pi-times"
        class="p-button-secondary custom-button"
        (click)="showModalPagos = false"
      ></button>
    </p-footer>
    </form>
</p-dialog>

</p-panel>
